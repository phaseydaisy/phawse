<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Snake — /next</title>
  <style>
    :root {
      --bg: #0b0f14;
      --panel: #121923;
      --accent: #53e5a8;
      --accent-2: #6bc1ff;
      --text: #e9eef5;
      --muted: #91a0b6;
      --danger: #ff6b7a;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: radial-gradient(1200px 800px at 10% 10%, #0f1622 0%, var(--bg) 60%);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      display: grid;
      place-items: center;
    }

    .wrap {
      width: min(92vw, 880px);
      display: grid;
      gap: 12px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(180deg, #152233, var(--panel));
      padding: 14px 16px;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06);
    }
    header h1 {
      margin: 0;
      font-size: 18px;
      letter-spacing: .4px;
      font-weight: 700;
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .dot { width: 10px; height: 10px; background: var(--accent); border-radius: 50%; box-shadow: 0 0 12px var(--accent); }
    .stats { display: flex; gap: 14px; align-items: center; font-variant-numeric: tabular-nums; }
    .pill { background: #0e1520; border: 1px solid #1b2636; padding: 6px 10px; border-radius: 999px; color: var(--muted); }
    .btn {
      cursor: pointer;
      border: 0;
      padding: 8px 12px;
      border-radius: 12px;
      background: linear-gradient(180deg, #1b2a3e, #142233);
      color: var(--text);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.08), 0 8px 18px rgba(0,0,0,.35);
      transition: transform .08s ease, filter .12s ease;
      user-select: none;
    }
    .btn:hover { filter: brightness(1.05); }
    .btn:active { transform: translateY(1px); }

    .panel {
      background: linear-gradient(180deg, #0f1723, var(--panel));
      border: 1px solid #1b2a3e;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 20px 50px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.05);
    }

    .board {
      position: relative;
      aspect-ratio: 1 / 1;
    }
    canvas { width: 100%; height: 100%; display: block; image-rendering: pixelated; }

    .overlay {
      position: absolute; inset: 0; display: grid; place-items: center; pointer-events: none;
    }
    .card {
      pointer-events: auto;
      background: rgba(7, 12, 19, .82);
      border: 1px solid #1c2a3d;
      backdrop-filter: blur(6px);
      padding: 18px 16px;
      border-radius: 16px;
      text-align: center;
    }
    .title { font-size: 22px; margin: 0 0 6px; }
    .muted { color: var(--muted); margin: 0 0 12px; }

    footer { display: grid; gap: 8px; }
    .controls { display: flex; gap: 8px; flex-wrap: wrap; }

    .grid {
      display: grid;
      grid-template-columns: repeat(3, 60px);
      gap: 10px;
      place-content: center;
      margin-top: 6px;
      align-self: center;
    }
    .dpad button {
      width: 60px; height: 60px; border-radius: 14px; border: 1px solid #1b2a3e; background: #0f1723; color: var(--text);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.05), 0 8px 18px rgba(0,0,0,.35);
      font-size: 16px; font-weight: 700; letter-spacing: .3px;
    }
    .hint { color: var(--muted); font-size: 12px; text-align: center; }

    @media (min-width: 720px) {
      .grid { grid-template-columns: repeat(3, 72px); gap: 12px; }
      .dpad button { width: 72px; height: 72px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1><span class="dot"></span> Snake</h1>
      <div class="stats">
        <div class="pill">Score: <span id="score">0</span></div>
        <div class="pill">Best: <span id="best">0</span></div>
        <button id="resetBtn" class="btn" aria-label="Reset (R)">Reset</button>
      </div>
    </header>

    <section class="panel board">
      <canvas id="game" width="480" height="480" aria-label="Snake game board" role="img"></canvas>
      <div id="overlay" class="overlay" hidden>
        <div class="card">
          <h2 id="overlayTitle" class="title"></h2>
          <p id="overlayMsg" class="muted"></p>
          <button id="overlayBtn" class="btn">Play</button>
        </div>
      </div>
    </section>

    <footer class="panel" style="padding: 12px 14px;">
      <div class="controls">
        <div class="pill">Move: ⬆️⬇️⬅️➡️ / WASD</div>
        <div class="pill">Reset: R</div>
        <div class="pill">Grid: 24×24</div>
      </div>
      <div class="dpad grid" aria-label="Touch controls">
        <div></div>
        <button data-dir="up">▲</button>
        <div></div>
        <button data-dir="left">◄</button>
        <div></div>
        <button data-dir="right">►</button>
        <div></div>
        <button data-dir="down">▼</button>
        <div></div>
      </div>
      <p class="hint">Tip: On mobile, use the on-screen D-pad or swipe anywhere on the board.</p>
    </footer>
  </div>

  <script>
    const GRID = 24;
    const SPEED = 7;
    const CELL = 20;
    const BOOST_EVERY = 5;

    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const bestEl = document.getElementById('best');
    const resetBtn = document.getElementById('resetBtn');
    const overlay = document.getElementById('overlay');
    const overlayTitle = document.getElementById('overlayTitle');
    const overlayMsg = document.getElementById('overlayMsg');
    const overlayBtn = document.getElementById('overlayBtn');

    let best = Number(localStorage.getItem('snake.best') || 0);
    bestEl.textContent = best;

    let snake, dir, nextDir, food, score, tickRate, foodsEaten, paused, alive;

    function reset() {
      snake = [{ x: Math.floor(GRID/2), y: Math.floor(GRID/2) }];
      dir = { x: 1, y: 0 }; nextDir = { ...dir };
      food = spawnFood(snake);
      score = 0; foodsEaten = 0; tickRate = SPEED; paused = false; alive = true;
      updateScore(0);
      hideOverlay();
    }

    function updateScore(delta) {
      score += delta;
      scoreEl.textContent = score;
      if (score > best) { best = score; bestEl.textContent = best; localStorage.setItem('snake.best', best); }
    }

    function spawnFood(body) {
      let p;
      do {
        p = { x: Math.floor(Math.random() * GRID), y: Math.floor(Math.random() * GRID) };
      } while (body.some(s => s.x === p.x && s.y === p.y));
      return p;
    }

    const keyDir = {
      ArrowUp:    { x: 0, y: -1 },
      ArrowDown:  { x: 0, y: 1 },
      ArrowLeft:  { x: -1, y: 0 },
      ArrowRight: { x: 1, y: 0 },
      w: { x: 0, y: -1 }, s: { x: 0, y: 1 }, a: { x: -1, y: 0 }, d: { x: 1, y: 0 }
    };

    function setDir(nd) {
      if (snake.length > 1 && nd.x === -dir.x && nd.y === -dir.y) return;
      nextDir = nd;
    }

    addEventListener('keydown', (e) => {
      const nd = keyDir[e.key];
      if (nd) setDir(nd);
      if (e.key.toLowerCase() === 'r'){ reset(); }
    });

    document.querySelectorAll('[data-dir]').forEach(btn => btn.addEventListener('click', () => {
      const d = btn.getAttribute('data-dir');
      const map = { up: {x:0,y:-1}, down:{x:0,y:1}, left:{x:-1,y:0}, right:{x:1,y:0} };
      setDir(map[d]);
    }));

    (function enableSwipe(){
      let sx=0, sy=0, active=false;
      const el = document.querySelector('.board');
      el.addEventListener('touchstart', (e)=>{ active=true; sx=e.touches[0].clientX; sy=e.touches[0].clientY; }, {passive:true});
      el.addEventListener('touchend', (e)=>{
        if(!active) return; active=false;
        const dx = (e.changedTouches[0].clientX - sx);
        const dy = (e.changedTouches[0].clientY - sy);
        if (Math.abs(dx) < 18 && Math.abs(dy) < 18) return;
        if (Math.abs(dx) > Math.abs(dy)) setDir({ x: Math.sign(dx), y: 0 });
        else setDir({ x: 0, y: Math.sign(dy) });
      }, {passive:true});
    })();

    resetBtn.addEventListener('click', reset);
    overlayBtn.addEventListener('click', () => { reset(); });

    function showOverlay(title, msg, buttonText='Play') {
      overlayTitle.textContent = title;
      overlayMsg.textContent = msg;
      overlayBtn.textContent = buttonText;
      overlay.hidden = false;
    }
    function hideOverlay(){ overlay.hidden = true; }

    function resizeCanvas() {
      const size = Math.min(canvas.parentElement.clientWidth, canvas.parentElement.clientHeight || canvas.parentElement.clientWidth);
      const cells = GRID * CELL;
      canvas.width = cells; canvas.height = cells;
    }
    addEventListener('resize', resizeCanvas);

    function drawCell(x, y, fill, stroke) {
      const s = CELL; const px = x * s, py = y * s;
      ctx.fillStyle = fill; ctx.fillRect(px, py, s, s);
      if (stroke){ ctx.strokeStyle = stroke; ctx.strokeRect(px + .5, py + .5, s - 1, s - 1); }
    }

    function drawBoard() {
      ctx.fillStyle = '#0b1420';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.strokeStyle = 'rgba(255,255,255,.03)';
      ctx.lineWidth = 1;
      for (let i = 0; i <= GRID; i++) {
        const p = i * CELL;
        ctx.beginPath(); ctx.moveTo(p + .5, 0); ctx.lineTo(p + .5, canvas.height); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(0, p + .5); ctx.lineTo(canvas.width, p + .5); ctx.stroke();
      }
      const grd = ctx.createRadialGradient((food.x + .5) * CELL, (food.y + .5) * CELL, 2, (food.x + .5) * CELL, (food.y + .5) * CELL, CELL * 2.2);
      grd.addColorStop(0, 'rgba(83,229,168,.35)');
      grd.addColorStop(1, 'rgba(83,229,168,0)');
      ctx.fillStyle = grd; ctx.beginPath(); ctx.arc((food.x + .5) * CELL, (food.y + .5) * CELL, CELL * 2.2, 0, Math.PI * 2); ctx.fill();
      drawCell(food.x, food.y, '#53e5a8', '#154a37');
      for (let i = 0; i < snake.length; i++) {
        const seg = snake[i];
        const isHead = i === 0;
        const fill = isHead ? '#6bc1ff' : '#b1d9ff';
        const stroke = isHead ? '#204b6b' : '#395e84';
        drawCell(seg.x, seg.y, fill, stroke);
      }
    }

    let last = 0, acc = 0;
    function step(ts) {
      requestAnimationFrame(step);
      if (!alive) return;
      if (!last) last = ts;
      const dt = (ts - last) / 1000; last = ts; acc += dt;
      const interval = 1 / tickRate;
      while (acc >= interval) { tick(); acc -= interval; }
      drawBoard();
    }

    function tick() {
      dir = nextDir;
      const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };
      if (head.x < 0 || head.x >= GRID || head.y < 0 || head.y >= GRID) {
        alive = false;
        showOverlay('Game Over', `Score ${score}. Press Play to restart.`, 'Restart');
        return;
      }
      if (snake.some((s, i) => i && s.x === head.x && s.y === head.y)) {
        alive = false;
        showOverlay('Game Over', `Score ${score}. Press Play to restart.`, 'Restart');
        return;
      }
      snake.unshift(head);
      if (head.x === food.x && head.y === food.y) {
        updateScore(1);
        foodsEaten++;
        if (foodsEaten % BOOST_EVERY === 0) tickRate += 0.7;
        food = spawnFood(snake);
      } else {
        snake.pop();
      }
    }

    function boot(){
      resizeCanvas();
      showOverlay('Snake', 'Press Play or tap to start.');
      alive = false;
    }

    boot();
    requestAnimationFrame(step);

    document.querySelector('.board').addEventListener('click', () => {
      if (!alive
